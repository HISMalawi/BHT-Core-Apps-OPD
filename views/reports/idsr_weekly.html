<html>
<meta charset="utf-8"/>
<title id="title"></title>
<link rel="stylesheet" href="/assets/css/bootstrap/bootstrap.min.css">
<link rel="stylesheet" href="/assets/css/maindashboard/footer.css">
<link rel="stylesheet" href="/assets/css/custom.css">
<script type="text/javascript" src="/apps/OPD/assets/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="/assets/js/core.js"></script>
<link rel="stylesheet" type="text/css" href="/apps/OPD/assets/css/DataTables/jquery.dataTables.min.css"/>
<script type="text/javascript" src="/apps/OPD/assets/js/DataTables/datatables.min.js"></script>
<script type="text/javascript" src="/assets/js/datatables/dataTables.buttons.min.js"></script>
<script type='text/javascript' src='/assets/js/datatables/jszip.min.js'></script>
<script type='text/javascript' src='/assets/js/datatables/pdfmake.min.js'></script>
<script type='text/javascript' src='/assets/js/datatables/vfs_fonts.js'></script>
<script type='text/javascript' src='/assets/js/datatables/buttons.html5.min.js'></script>
<script type='text/javascript' src='/assets/js/datatables/buttons.print.min.js'></script>
<script src="/assets/js/moment.js"></script>
<script type="text/javascript" src="/assets/js/virtual.keyboard.js"></script>
<script type="text/javascript" src="/apps/OPD/assets/js/report_customise.js"></script>
<style type="text/css" xmlns="http://www.w3.org/1999/html">

#tasks {
  visibility: hidden;
  margin-right: 10px;
}

@page {
  size: auto;   /* auto is the current printer page size */
  margin: 0mm;  /* this affects the margin in the printer settings */
  font-size: 12px;
}

body {
  background-color:#FFFFFF; 
  border: solid 1px black ;
  margin: 0px;  /* the margin on the content before printing */
}

#spinner{
  display: none;
}

#report-cover {
  display: none;
}

#report-cover-2 {
  display: none;
}

table {
  width: 100%;
  border-collapse: collapse;
}

td {
  border-style: solid;
  border-width: 1px;
}

#version {
  text-align: right;
  padding-right: 5px;
  font-size: 10px;
}

.numbers {
  width: 2.5%;
  text-align: center;
  border-width: 0px 1px 0px 0px;
  border-style: dotted;
}

.td-clear-left {
 border-left-style: none;
}

.dt-buttons {
  margin: 0 20px 0;
}

#idsr_weekly {
  width: 98% !important;
  border-collapse: collapse !important;
}

#idsr_weekly_wrapper table.dataTable thead th, table.dataTable thead td {
    padding: 10px 18px;
    border-bottom: none !important;
}

.td-clear-right {
 border-right-style: none;
}

.td-text-align-left {
  text-align: left;
  padding-left: 10px;
  width: 20%;
}

.td-text-align-right {
  text-align: center;

}

.td-span-width {
 
}

.row-title {
  width: 17.75%;
  text-align: left;
  padding-left: 5px;
  border-style: dotted;
}

.signatures {
  width: 39.875%;
  text-align: left;
  padding-left: 5px;
  border-style: dotted;
}

.row-name {
  width: 39.875%;
  text-align: left;
  padding-left: 5px;
  border-style: dotted;
  border-left-style: solid;
}

.no-borders {
  border-width: 0px;
}

#version-row td {
  height: 30px;
}

.modal {
  position: fixed;
  width: 93%;
  margin-left: 4%;
  top: 4%;
  z-index: 992;
}

.dt-button {
  border: 1px solid #7eb9d0;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  font-size: 28px;
  font-family: arial, helvetica, sans-serif;
  padding: 10px 10px 10px 10px;
  text-decoration: none;
  display: inline-block;
  text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
  font-weight: bold;
  color: #FFFFFF;
  background-color: #a7cfdf;
  background-image: -webkit-gradient(linear, left top, left bottom, from(#a7cfdf), to(#23538a));
  background-image: -webkit-linear-gradient(top, #a7cfdf, #23538a);
  background-image: -moz-linear-gradient(top, #a7cfdf, #23538a);
  background-image: -ms-linear-gradient(top, #a7cfdf, #23538a);
  background-image: -o-linear-gradient(top, #a7cfdf, #23538a);
  background-image: linear-gradient(to bottom, #a7cfdf, #23538a);
  filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#a7cfdf, endColorstr=#23538a);
}

.keyboardButton {
  border: 1px solid #7eb9d0;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 5px !important;
  font-size: 25px !important;
  font-family: arial, helvetica, sans-serif;
  padding: 10px 10px 10px 10px;
  text-decoration: none;
  display: inline-block;
  text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
  font-weight: 700;
  color: #fff;
  background-color: #a7cfdf;
  background-image: -webkit-gradient(linear, left top, left bottom, from(#a7cfdf), to(#23538a));
  background-image: -webkit-linear-gradient(top, #a7cfdf, #23538a);
  background-image: -moz-linear-gradient(top, #a7cfdf, #23538a);
  background-image: -ms-linear-gradient(top, #a7cfdf, #23538a);
  background-image: -o-linear-gradient(top, #a7cfdf, #23538a);
  background-image: linear-gradient(to bottom, #a7cfdf, #23538a);
  filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=#a7cfdf, endColorstr=#23538a);
  min-width: 70px;
  min-height: 55px;
  cursor: pointer;
  width: ;
  height: 35px;
  text-align: center;
  margin: 3.3px;
}

.rectangle_fab {
  background-color: #eaeaea;
  border: solid 8px #eaeaea;
  border-right: solid 60px #eaeaea;
  border-left: solid 60px #eaeaea;
  font-size: large;
}

a:focus, a:hover {
  color: #23527c;
  text-decoration: none;
}

#virtual-keyboard{
  z-index: 993 !important;
  text-align: center;
  left: 170px !important;
  top: 320px !important;
  height: auto !important;
}

.keyboardButton {
    font-size: 35px;
    font-family: arial, helvetica, sans-serif;
    text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.3);
    margin-top: 3%;
}

.modal-header {
  font-size: 16px !important;
}

.gray-cell {
  background-color: grey;
}

/* .......... second section starts here ------- */
table {
  width: 97%;
  border-collapse: collapse;
  margin-top: 10px;
  margin-left: 15px;
}

#idsr_weekly {
  margin-bottom: -45px;
}

tr {
  height: 45px;
}

.vertical-separator {
  border-width: 0px;
}

td {
  border-style: solid;
  border-width: 1px;
}

.section-description td {
  border-width: 0px;
}

.horisonatl-separator td {
  border-width: 0px;
}

.numbers {
  width: 2.5%;
  text-align: center;
  border-width: 0px 1px 0px 0px;
  border-style: dotted;
}

.sum-arrows {
  width: 75px;
  height: 55px;
}

.postfixes {
  font-size: x-small;
  font-weight: bold;
  position: relative;
  top: -15px;
  left: -40px;
}

#spinner {
  position: absolute;
  top: 150px;
  left: 40%;
  z-index: 1001;
}

#report-cover {
  position: absolute;
  background-color: black;
  width: 100%;
  height: 102%;
  left: 0%;
  top: 0%;
  z-index: 990;
  opacity: 0.65;
}

#report-cover-2 {
  position: absolute;
  background-color: black;
  width: 100%;
  height: 102%;
  left: 0%;
  top: 0%;
  z-index: 1000;
  opacity: 0.65;
}

td {
  padding-right: 15px;
  text-align: center;
}

#consistency_check div{
  color: red;
  padding-left: 20px;
}

#incosistence_title {
  text-align: center;
}

.granules {
  width: 100%;
  height: 32px;
  margin: 10px;
  display: table;
}

.granules-row {
  display: table-row;
}

.granules-cell {
  display: table-cell;
  text-align: center;
}

.granules span{
  font-size: 10px;
}

.granules-right-td {
  border-right-style: dotted !important;
  border-right-width: 1px;
}

</style>

<script>
var print_pdf_attr = {};

</script>

<div id="consistency_check">
  <div id="patients_consistency"></div>
  <div id="cum_patients_consistency"></div>

  <div id="total_registered_disag"></div>
  <div id="cum_total_registered_disag"></div>
  
  <div id="gender_consistency"></div>
  <div id="cum_gender_consistency"></div>
  <div id="age_consistency"></div>
  <div id="cum_age_consistency"></div>
  <div id="reasons_consistency"></div>
  <div id="cum_reasons_consistency"></div>
  <div id="conditions_consistency"></div>
  <div id="cum_conditions_consistency"></div>
  <div id="died_consistency"></div>
  <div id="total_consistency"></div>
  <div id="regimen_consistency"></div>
  <div id="pregnant_consistency"></div>
  <div id="tb_status_consistency"></div>
  <div id="side_effect_consistency"></div>
  <div id="adherence_consistency"></div>
</div>

<div id="content" style="margin-bottom: 100px;">

  <table>
  <tr id="">
    <td colspan="5" id="" style="border-right-style: solid; font-weight: bold; text-align: center;">WEEKLY DISEASE SURVEILLANCE REPORT</td>
  </tr>
  <tr>
    <td class="td-text-align-left">Country:</td>
    <td class="td-text-align-left">Malawi</td>
  </tr>
  <tr>
    <td class="td-text-align-left">Reporting Facility Name:</td>
    <td class="td-text-align-left"><span id="faci_name"></span></td>
  </tr>
  <tr>
    <td class="td-text-align-left">Week Number:</td>
    <td class="td-text-align-left"><span id="wknum"></span></td>
  </tr>
  <tr>
    <td class="td-text-align-left">Week Dates: </td>
    <td class="td-text-align-left"><span id="wkdates"></span></td>
  </tr>
  <tr>
    <td class="td-text-align-left">Total OPD Visits: </td>
    <td class="td-text-align-left"><span id="total_visits"></span></td>
  </tr>
  <tr>
    <table id="idsr_weekly">
      <thead>
        <tr>
         <th></th>
         <th></th>
         <th></th>
         <th></th>
         <th></th>
        </tr>
       </thead>
      <tbody id="append-header">

        <tr style="display: none">
          <td class="td-text-align-right"></td>
          <td class="td-text-align-right" style="width: 30%;">Diseases/Events/Conditions</td>
          <td id="ls-5ys" class="td-text-align-right">&#60;5 years</td>
          <td id="grt-5yrs" class="td-text-align-right">&#62;&#61;5 years</td>
          <td id="total" class="td-text-align-right">Total</td>
        </tr>

  <tr id="_1">
    <td class="td-text-align-right" style="width: 5%;">1</td -->
    <td class="td-text-align-right" style="width: 30%;">AEFI</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right" >0</a></td>
  </tr>
  <tr id="_2">
    <td class="td-text-align-right">2</td>
    <td class="td-text-align-right" style="width: 30%;">AFP (Poliomyelitis***)</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_3">
    <td class="td-text-align-right">3</td>
    <td class="td-text-align-right" style="width: 30%;">AHFS</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_4">
    <td class="td-text-align-right">4</td>
    <td class="td-text-align-right" style="width: 30%;">Anthrax</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_5">
    <td class="td-text-align-right">5</td>
    <td class="td-text-align-right" style="width: 30%;">Cholera</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_6">
    <td class="td-text-align-right">6</td>
    <td class="td-text-align-right" style="width: 30%;">Covid-19</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_7">
    <td class="td-text-align-right">7</td>
    <td class="td-text-align-right" style="width: 30%;">Dengue</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_8">
    <td class="td-text-align-right">8</td>
    <td class="td-text-align-right" style="width: 30%;">Diarrhoea with blood (Shigella)</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>

  <tr id="_9">
    <td class="td-text-align-right">9</td>
    <td class="td-text-align-right" style="width: 30%;">Influenza due to new subtype</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_10">
    <td class="td-text-align-right">10</td>
    <td class="td-text-align-right" style="width: 30%;">Listeriosis</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_11">
    <td class="td-text-align-right">11</td>
    <td class="td-text-align-right" style="width: 30%;">Malaria</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_12">
    <td class="td-text-align-right">12</td>
    <td class="td-text-align-right" style="width: 30%;">Maternal death</td>
    <td id="ls-5yrs" class="td-text-align-right gray-cell"></td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_13">
    <td class="td-text-align-right">13</td>
    <td class="td-text-align-right" style="width: 30%;">Measles</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_14">
    <td class="td-text-align-right">14</td>
    <td class="td-text-align-right" style="width: 30%;">Meningococcal Meningitis</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_15">
    <td class="td-text-align-right">15</td>
    <td class="td-text-align-right" style="width: 30%;">Neonatal tetanus</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right gray-cell"></td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_16">
    <td class="td-text-align-right">16</td>
    <td class="td-text-align-right" style="width: 30%;">PHEIC</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>

  <tr id="_17">
    <td class="td-text-align-right">17</td>
    <td class="td-text-align-right" style="width: 30%;">Plague</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_18">
    <td class="td-text-align-right">18</td>
    <td class="td-text-align-right" style="width: 30%;">Rabies (Human)</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_19">
    <td class="td-text-align-right">19</td>
    <td class="td-text-align-right" style="width: 30%;">SARIs**</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_20">
    <td class="td-text-align-right">20</td>
    <td class="td-text-align-right" style="width: 30%;">SARS</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_21">
    <td class="td-text-align-right">21</td>
    <td class="td-text-align-right" style="width: 30%;">Small pox</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_22">
    <td class="td-text-align-right">22</td>
    <td class="td-text-align-right" style="width: 30%;">Typhoid fever</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  <tr id="_23">
    <td class="td-text-align-right">23</td>
    <td class="td-text-align-right" style="width: 30%;">Yellow fever</td>
    <td id="ls-5yrs" class="td-text-align-right">0</td>
    <td id="grt-5yrs" class="td-text-align-right">0</td>
    <td id="total" class="td-text-align-right">0</td>
  </tr>
  </tbody>
  </table>
</tr>
</table>

</div>
<div id="editor"></div>

<footer class="footer">
  <div class="container-footer">
    <button id="btnNext" class="green right" style="margin: 5px 0px 0px; padding: 0px; float: right;" onclick="location='/';">
      <span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Finish &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;</span>
    </button>
    <!-- <button id="activities" class="btn btn-success buttons blue" style="margin-right: 5px;" onmousedown="javascript:printWindow();">
      <span>&nbsp; &nbsp; &nbsp; Print &nbsp; &nbsp; &nbsp;</span>
    </button> -->
    <button id="tasks" class="btn btn-success buttons blue" style="margin-right: 5px;"  onmousedown="">
      <span>&nbsp; Export &nbsp;</span>
    </button>
    <button id="btnNext" class="red right" style="margin: 5px 0px 0px; padding: 0px; float: left;" onclick="location='/';">
      <span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Cancel &nbsp; &nbsp;&nbsp;</span>
    </button>
  </div>
</footer>

<img src="/apps/OPD/assets/images/formloader.gif" id="spinner" />
<div id="report-cover"></div>
<div id="report-cover-2"></div>

<script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
<script>

function getUrlVars() {
  var vars = {};
  var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
    vars[key] = value;
  });
  return vars;
}

var idsrResults;

function getIndicators() {
  var responseTracker = 0;
  var trackerSupport = Math.round(idsr_diagnosis.length/2)+2;

  var url = apiProtocol + "://" + apiURL + ":" + apiPort;
    url += '/generate_weekly_idsr_report?start_date=' + start_date;
    url += '&end_date=' + end_date + "&date=" + sessionStorage.sessionDate;
    url += '&program_id=' + sessionStorage.programID;
    url += '&request=true';

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
      getRegistration();
      runningReport = false
      idsrResults = JSON.parse(this.responseText);
      var count_for_condition = 1;
      for (const [key, value] of Object.entries(idsrResults)) {
        var row = document.getElementById('_'+count_for_condition);
        row.children[1].innerHTML = key;

        count_for_condition++;
        var count_for_clmns = 2;
        var total = 0;
        var total_ids = '';

        for (const [key1, value1] of Object.entries(value)) {    
          row.children[count_for_clmns].innerHTML = value1.length;
          total+=value1.length;
          
          var storage_name = key+key1;
          var ids ='';
          
          for(var k=0; k<value1.length; k++) {
            ids += '|'+value1[k]; 
          }

          if(value1.length != 0) {
            row.children[count_for_clmns].setAttribute('onclick','view_patientD(\''+storage_name+'\')')
            row.children[count_for_clmns].setAttribute('class','grt_fv_drill')
            row.children[count_for_clmns].innerHTML = value1.length
           // row.children[count_for_clmns].innerHTML = '<a class="rectangle_fab" href="#" onclick="view_patientD(\''+storage_name+'\')">'+value1.length+'</a>';
            sessionStorage.setItem(storage_name, ids);
            total_ids += ids;
          }

          count_for_clmns++;
        }

        if (total > 0) {
          row.children[count_for_clmns].innerHTML = total;
          row.children[count_for_clmns].innerHTML = '<a class="rectangle_fab" href="#" onclick="view_patientD(\''+key+'total'+'\')">'+total+'</a>';
          sessionStorage.setItem(key+'total', total_ids);
        }
      }

    function makeBlank(obj = []) {
      for (sobj of obj) {
        console.log(sobj.tr_id)
        var tr = document.getElementById(sobj.tr_id)
        for (var e of tr.children) {
          var str = e.id
          if ( sobj.e_id == str) {
            e.innerHTML = ''
          }
        }
      }
    }

    var _blnk = []
    _blnk.push(    {
      tr_id : "_12",
      e_id  : "ls-5yrs"
    })
    _blnk.push(    {
      tr_id : "_15",
      e_id  : "grt-5yrs"
    })

    makeBlank(_blnk)
    addVersionControl()
    initializeTable()
    addButton()
    addHeader()
    modifyEntriesNumber()
    document.getElementById('spinner').style = 'display: none';
    document.getElementById('report-cover').style = 'display: none;';
      
    if(reload_status == true) 
      location.reload();

    } else if (this.readyState === 4) {
      runningReport = true;
      //setTimeout(getIndicators, 10000);
    } else if (this.status == 500) {
        //trackerSupport--;
    }
  };
  
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
  xhttp.setRequestHeader('Content-type', "application/json");
  xhttp.send();  
}

function addVersionControl() {
  function getFormatedPeriod() {
    var start_date = url.searchParams.get("start_date");
    var end_date = url.searchParams.get("end_date");
    var start_date_formated = moment(start_date).format('DD/MMM/YYYY');
    var end_date_formated = moment(end_date).format('DD/MMM/YYYY');
    var period = start_date_formated +"  -  "+ end_date_formated
    return period;
  }
  var tr = document.getElementById('_23')
  var tr_to_insert = document.createElement('tr')
  tr_to_insert.setAttribute('style', 'display:none')
  var td = document.createElement('td')
  var td1 = document.createElement('td')
  td1.innerHTML = "BHT-Core Version :"+sessionStorage.coreVersion+
    "    OPD Version :"+sessionStorage.OPDVersion+
    "    API Version :"+sessionStorage.apiVersion+
    "    Report Period :"+getFormatedPeriod()+
    "    Site :"+sessionStorage.currentLocation
  var td2 = document.createElement('td')
  var td3 = document.createElement('td')
  var td4 = document.createElement('td')
  tr_to_insert.append(td)
  tr_to_insert.append(td1)
  tr_to_insert.append(td2)
  tr_to_insert.append(td3)
  tr_to_insert.append(td4)
  insertAfter(tr_to_insert, tr)
}

function addButton() {
  var trs = document.getElementsByClassName('grt_fv_drill')

  for(var e of trs) {
    var anchor = document.createElement('a')
    var value = e.innerHTML
    e.innerHTML = ''
    anchor.setAttribute('class','rectangle_fab')
    anchor.setAttribute('href','#')
    anchor.innerHTML = value
    e.append(anchor)
    
  }
}

function insertAfter(newNode, existingNode) {
  existingNode.parentNode.insertBefore(newNode, existingNode.nextSibling);
}

function addHeader() {
  var header = `<tr>
          <td rowspan="2" colspan="2" class="td-text-align-left">Diseases/Events/Conditions</td>
          <td colspan="3" class="td-text-align-left" style="text-align: center;">Out-patient Cases</td>
        </tr>
        <tr>
          <td class="td-text-align-left td-span-width">&#60;5 yrs</td>
          <td class="td-text-align-left td-span-width">&#62;&#61;5 yrs</td>
          <td class="td-text-align-left td-span-width">Total</td>
        </tr>`

  $('#append-header').prepend(header)
}

function getRegistration() {
  var url = apiProtocol + "://" + apiURL + ":" + apiPort + "/api/v1";
    url += '/registration?start_date=' + start_date;
    url += '&end_date=' + end_date + "&date=" + sessionStorage.sessionDate;
    url += '&program_id=' + sessionStorage.programID;

  if(apiProtocol == undefined) {
    setTimeout("getData()", 3000);
    return;
  }

  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
      var obj = JSON.parse(this.responseText);
      setVisitsValue(obj);
      document.getElementById('spinner').style = 'display: none;';
      document.getElementById('report-cover').style = 'display: none;';
    }
  };
  xhttp.open("GET", url, true);
  xhttp.setRequestHeader('Authorization', sessionStorage.getItem("authorization"));
  xhttp.setRequestHeader('Content-type', "application/json");
  xhttp.send();
}

function setVisitsValue(data) {
  var count = data.length
  var e = document.getElementById('total_visits')
  e.innerHTML = count
}

var myVar;
var runningReport = true;
var reload_status = false;

function checkIfReportReady() {
  // myVar = setTimeout(getIndicators, 10000);
  // if(runningReport == false)
  //   location.reload()
}

const idsr_diagnosis = ["Diarrhea",
"Poliomyelitis",
"AHFS",
"Anthrax",
"Cholera",
"Covid-19",
"Dengue",
"Dysentery",
"Influenza due to new subtype",
"Listeriosis",
"Malaria",
"Maternal death",
"Measles",
"Meningococcal Meningitis",
"Neonatal tetanus",
"PHEIC",
"Plague",
"Rabies",
"Acute respiratory infection",
"SARS",
"Small pox",
"Typhoid fever",
"Yellow fever"
];

var start_date = getUrlVars()["start_date"];
var end_date = getUrlVars()["end_date"];
var week_number = getUrlVars()['week_number'];
week_number = week_number.split('&');
document.getElementById('wknum').innerHTML = week_number[0];
document.getElementById('faci_name').innerHTML = sessionStorage.currentLocation;
document.getElementById('wkdates').innerHTML = start_date +"&nbsp;&nbsp;&nbsp;to&nbsp;&nbsp;&nbsp;"+ end_date;
document.getElementById('spinner').style = 'display: inline;';
document.getElementById('report-cover').style = 'display: inline;';
getIndicators();

function printWindow() {
  var exportButtons = document.getElementsByClassName('dt-buttons')
  for(var e of exportButtons) {
    e.setAttribute('style','display: none')
  }
  //exportButtons.setAttribute('style','display: none')
  var items = document.getElementsByTagName("a");
  for (let e of items) {
    e.setAttribute("class", "")
  }
  var footer = document.getElementsByClassName('footer')[0];
  footer.style = 'display: none;';
  window.print();
  for (let e of items) {
    e.setAttribute("class", "rectangle_fab")
  }
  footer.style = 'display: inline;';
  for(var e of exportButtons) {
    e.setAttribute('style','display: block')
  }
}

function initializeTable() {
  table = $('#idsr_weekly').DataTable({
    fixedHeader: false,
    searching: false,
    scrollY: 1150,
    paging: false,
    aaSorting: [],
    Processing: true,
    ServerSide: true,
    scroller: {
    loadingIndicator: true
    },
    dom: 'Bfrtip',
    buttons: [
    'csv', 'pdf', 'print'
  ]
  });
}

function initializeTable_Modal() {
  table = $('#patient_details_table').DataTable({
    fixedHeader: true,
    searching: true,
    paging: true,
    scrollY: 300,
    Processing: true,
    ServerSide: true,
    scroller: {
        loadingIndicator: true
    },
    dom: 'Bfrtip',
    buttons: [
    'copy', 'csv', 'pdf', 'print'
    ]
  });

  lookForTag();
}

function view_patientD(name) {    
  if($('#virtual-keyboard').length)
    hide_keyboard();

  $('.keyboard').attr('style','display:none');
  document.getElementById('spinner').style = 'display: block;';  
  document.getElementById('report-cover-2').style = 'display: block;';
  dataTableContentLoader(name);
}

function dataTableContentLoader(name) {   
  var diagName;
  var period;
  if (name.indexOf('total') != -1) {
    diagName = name.replace('total','');
    period = "Total";
  }

  if (name.indexOf('<5yrs') != -1) {
    diagName = name.replace('<5yrs','');
    period = "Less Than Five Years";
  }

  if (name.indexOf('>=5yrs') != -1) {
    diagName = name.replace('>=5yrs','');
    period = "Greater Than Five Years";
  }
  
  IDsArray = sessionStorage.getItem(name);
  IDsArray =IDsArray.split('|');

  var progressTracker = 0;

  $('.modal-title').html('<b>Condition:</b> &nbsp;&nbsp; ' + diagName);
  $('.period').html('<b>Age Group:</b>  &nbsp;&nbsp;' + period);
  document.getElementById('modal').setAttribute('style','display:block');
  $('#patient_details_body').html('');

  for (var n=1; n<IDsArray.length; n++) {
    var patient_id = IDsArray[n];
    var url = sessionStorage.apiProtocol + '://'+apiURL+':'+apiPort+'/api/v1/patients/';
    url +=   patient_id;

    var req = new XMLHttpRequest();
    req.onreadystatechange = function(){
      if (this.readyState == 4) {
        if (this.status == 200) {
          progressTracker++;
          var results = JSON.parse(this.responseText);
          var one_person = results.person
          let addresses_obj = one_person.addresses[0]
          let address = addresses_obj.state_province +", "+ addresses_obj.city_village +", "+ addresses_obj.address1

          var tr = document.createElement('tr');
          document.getElementById('patient_details_body').appendChild(tr);

          var td = document.createElement('td');
          td.setAttribute("class","td-text-align-left");
          td.innerHTML = one_person.person_id;
          tr.appendChild(td);

          td = document.createElement('td');
          td.setAttribute("class","td-text-align-left");
          td.innerHTML = one_person.names[0].given_name;
          tr.appendChild(td);

          var td = document.createElement('td');
          td.setAttribute("class","td-text-align-left");
          td.innerHTML = one_person.names[0].family_name;
          tr.appendChild(td);

          td = document.createElement('td');
          td.setAttribute("class","td-text-align-left");
          td.innerHTML = one_person.gender;
          tr.appendChild(td);

          td = document.createElement('td');
          td.setAttribute("class","td-text-align-left");
          td.innerHTML = one_person.person_attributes[1].value;
          tr.appendChild(td);
          
          td = document.createElement('td');
          td.innerHTML = address;
          tr.appendChild(td);

          if (progressTracker == IDsArray.length-1) {
            initializeTable_Modal();
            $("label [aria-controls*='report']").attr('type','text');
            document.getElementById('spinner').style = 'display: none;';
            document.getElementById('report-cover-2').style = 'display: none;';
            document.getElementById('report-cover').style = 'display: block;';
          }
        }
      }
    };

    try {
      req.open('GET', url, true);
      req.setRequestHeader('Authorization',sessionStorage.getItem('authorization'));
      req.send(null);
    } catch (e) {
    }   
  }
}

function close_modal() {
  document.getElementById('spinner').style = 'display: none;';
  document.getElementById('report-cover').style = 'display: none;';
  document.getElementById('patient_details_body').innerHTML = "";
  document.getElementById('modal').setAttribute('style','display:none');
  table.destroy();
  hide_keyboard();
}

function modifyEntriesNumber() {
  var idsr_weekly_info = document.getElementById('idsr_weekly_info')
  idsr_weekly_info.setAttribute('style','display:none')
}

function hide_keyboard() {
  var vl = document.getElementById('virtual-keyboard');
  var w = document.getElementsByTagName('body')[0];
  w.removeChild(vl);
}
addReportTitle("IDSR Weekly Report");
</script>
<!-- Modal -->
<div class="modal " id="modal" style="display: none;" > 
  <div class="modal-content" style="margin-left:0px; ">
    <div class="modal-header">
      <div class="modal-title _title" ></div>
      <div class="period _title" ></div>
    </div>
    <div class="modal-body">
      <div class="container">
        <div class="row" id="modal-div">
          <div id="patient_details_card" style="margin-bottom: 10px; border-bottom: 1px solid; width: 95%;" >
            <table id="patient_details_table" class="display " >
              <thead>
                <tr>
                  <th class="sorting_patient" >Patient ID</th>
                  <th class="sorting_patient">Firstname</th>
                  <th class="sorting_patient">Surname</th>
                  <th class="sorting_patient">Gender</th>
                  <th class="sorting_patient">Phone Number</th>
                  <th class="sorting_patient">Address</th>
                </tr>
              </thead>
              <tbody id="patient_details_body">
              </tbody>
            </table>   
          </div>
        </div>
      </div>
    </div>
      <div class="bottom_buttons">
        <button class="red"  onclick="close_modal()" style="margin-left: 2%;
        margin-top: -1%;
        margin-bottom: 2%;">Close</button>
      </div>
  </div> 
</div>
<!-- Modal -->

</html>
